<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Notification API æ¼”ç¤º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif;
    }
    body {
      max-width: 600px;
      margin: 30px auto;
      padding: 0 20px;
      background: #f7f9fc;
      color: #222;
    }
    .container {
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #1a73e8;
      text-align: center;
    }
    .desc {
      color: #5f6368;
      margin-bottom: 24px;
      line-height: 1.6;
      text-align: center;
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 20px;
    }
    button {
      flex: 1;
      min-width: 140px;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      background: #1a73e8;
      color: #fff;
      transition: background 0.2s;
    }
    button:hover {
      background: #0d66d0;
    }
    button.gray {
      background: #5f6368;
    }
    button.gray:hover {
      background: #4d5156;
    }
    .log-box {
      padding: 16px;
      background: #f1f3f4;
      border-radius: 8px;
      min-height: 100px;
      white-space: pre-line;
      font-size: 14px;
      color: #202124;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Notification API æ¼”ç¤º</h1>
  <p class="desc">
    æµè§ˆå™¨æ¡Œé¢é€šçŸ¥æ¼”ç¤ºï¼Œéœ€ HTTPS æˆ– localhost ç¯å¢ƒ<br>
    è¯·å…ˆæˆæƒé€šçŸ¥æƒé™ï¼Œå†ç‚¹å‡»æŒ‰é’®æµ‹è¯•
  </p>

  <div class="btn-group">
    <button id="requestBtn">è¯·æ±‚é€šçŸ¥æƒé™</button>
    <button id="showBtn">ç«‹å³å‘é€é€šçŸ¥</button>
  </div>
  <div class="btn-group">
    <button id="delayBtn">3ç§’åå‘é€</button>
    <button id="closeBtn" class="gray">å…³é—­æ‰€æœ‰é€šçŸ¥</button>
  </div>

  <h3 style="margin:24px 0 10px;">æ“ä½œæ—¥å¿—</h3>
  <div id="log" class="log-box">ç­‰å¾…æ“ä½œ...</div>
</div>

<script>
  const logBox = document.getElementById('log');
  let notifications = []; // ä¿å­˜é€šçŸ¥å®ä¾‹ï¼Œç”¨äºç»Ÿä¸€å…³é—­

  // æ—¥å¿—è¾“å‡º
  function log(msg) {
    logBox.textContent = `[${new Date().toLocaleTimeString()}] ${msg}\n` + logBox.textContent;
  }

  // 1. è¯·æ±‚æƒé™
  document.getElementById('requestBtn').addEventListener('click', async () => {
    if (!('Notification' in window)) {
      log('âŒ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ Notification API');
      return;
    }
    const perm = await Notification.requestPermission();
    log(`ğŸ” æƒé™çŠ¶æ€ï¼š${perm}`);
  });

  // 2. ç«‹å³å‘é€é€šçŸ¥
  document.getElementById('showBtn').addEventListener('click', () => {
    showNotification('å³æ—¶é€šçŸ¥', {
      body: 'è¿™æ˜¯ä¸€æ¡ç«‹å³è§¦å‘çš„æ¡Œé¢é€šçŸ¥',
      icon: 'https://picsum.photos/64/64'
    });
  });

  // 3. å»¶è¿Ÿå‘é€
  document.getElementById('delayBtn').addEventListener('click', () => {
    log('â° 3ç§’åå°†å‘é€é€šçŸ¥...');
    setTimeout(() => {
      showNotification('å»¶æ—¶é€šçŸ¥', {
        body: 'æˆ‘æ˜¯å»¶è¿Ÿ3ç§’å¼¹å‡ºçš„æ¶ˆæ¯',
        icon: 'https://picsum.photos/64/64'
      });
    }, 3000);
  });

  // 4. å…³é—­æ‰€æœ‰é€šçŸ¥
  document.getElementById('closeBtn').addEventListener('click', () => {
    notifications.forEach(n => n.close());
    notifications = [];
    log('ğŸ—‘ å·²å…³é—­æ‰€æœ‰é€šçŸ¥');
  });

  // å°è£…å‘é€é€šçŸ¥
  function showNotification(title, options) {
    if (!('Notification' in window)) {
      log('âŒ ä¸æ”¯æŒ Notification');
      return;
    }
    if (Notification.permission !== 'granted') {
      log('âš ï¸ è¯·å…ˆç‚¹å‡»ã€Œè¯·æ±‚é€šçŸ¥æƒé™ã€å¹¶å…è®¸');
      return;
    }

    const n = new Notification(title, options);

    // äº‹ä»¶ç›‘å¬
    n.onclick = () => {
      log('âœ… ç”¨æˆ·ç‚¹å‡»äº†é€šçŸ¥');
      window.focus(); // åˆ‡å›é¡µé¢
      n.close();
    };
    n.onclose = () => {
      log('â„¹ï¸ é€šçŸ¥å·²å…³é—­');
    };
    n.onerror = (err) => {
      log(`âŒ é€šçŸ¥å‡ºé”™ï¼š${err.message}`);
    };

    notifications.push(n);
  }
</script>
</body>
</html>
